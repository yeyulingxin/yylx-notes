前言
建单介绍一下redis常见的集群使用策略和各自的优缺点；
集群部署方式
主从模式
Redis的主从模式是一种常见的架构模式，主要应用于数据存储和管理。在这种模式下，主节点（master node）和从节点（slave
node）被部署在不同的服务器上，主节点主要负责数据的写入操作，而从节点则负责数据的读取操作。

优点：

1. 读写分离：通过主从模式，可以将读和写操作分离开来，提高系统的性能和可扩展性。
2. 数据备份：从节点可以备份主节点的数据，提供数据热备份的功能，确保数据的安全性和可靠性。
3. 负载均衡：主从模式可以有效地分担系统的负载，提高系统的处理能力和吞吐量。

不足：

1. 主节点故障：如果主节点出现故障，整个系统将无法进行写入操作，可用性相对较低。
2. 从节点升级为主节点需要人工手动干预：当主节点出现故障时，需要手动将一个从节点升级为主节点，这个过程可能会对系统造成一定的干扰。
3. 全量同步可能会造成毫秒或者秒级的卡顿现象：在进行全量复制时，主节点需要将所有的数据传输给从节点，这可能会导致系统性能的降低。

哨兵模式
Redis的哨兵模式是一种高可用性解决方案，它由一个或多个哨兵节点组成，用于监控主从结构中的每台服务器。
哨兵模式的核心功能是在主从复制的基础上引入了主节点的自动故障转移。当主节点不能正常工作时，哨兵会开始自动故障转移操作，将失效主节点的其中一个从节点升级为新的主节点，并让其他从节点改为复制新的主节点。

优点：

1. 高可用性：哨兵模式能够自动处理故障转移，保证数据的可靠性和系统的可用性。
2. 可扩展性：哨兵模式可以方便地增加新的哨兵节点，以支持更大的集群规模和更高的并发量。
3. 自动监控：哨兵模式能够自动监控Redis主从节点的状态，及时发现故障并进行处理。
4. 负载均衡：哨兵模式可以将客户端的请求分散到不同的Redis节点上，实现负载均衡，提高系统的处理能力和吞吐量。

不足：

1. 配置复杂：哨兵模式的配置相对复杂，需要仔细配置哨兵节点和数据节点，确保整个集群的正常运行。
2. 数据同步：在哨兵模式下，主节点和从节点的数据同步需要一定的时间，这可能会导致数据一致性的问题。
3. 性能开销：哨兵模式需要额外的哨兵节点来进行监控和故障转移处理，这可能会对系统的性能造成一定的影响。
4. 单点故障：虽然哨兵模式可以处理主节点的故障转移，但如果所有的哨兵节点都出现了故障，整个集群可能会受到影响。

cluster模式
Redis Cluster模式是一种分布式数据存储方案，它由多个Redis节点组成，每个节点都存储一部分数据，并且节点之间通过特定的通信协议进行数据交互和故障转移处理。

优点：

1. 水平扩展性：Redis Cluster模式可以方便地增加节点数量，以支持更大的数据存储需求。
2. 高可用性：Redis Cluster模式通过多个节点之间的数据复制和故障转移机制，可以保证数据的可靠性和系统的可用性。
3. 自动分片：Redis Cluster模式可以自动将数据分片存储在不同的节点上，无需手动进行数据分片和迁移。
4. 负载均衡：Redis Cluster模式可以将客户端的请求分散到不同的节点上，实现负载均衡，提高系统的处理能力和吞吐量。

不足：

1. 配置复杂：Redis Cluster模式的配置相对复杂，需要仔细配置多个节点之间的通信和数据复制等参数。
2. 数据一致性：Redis Cluster模式的数据复制是异步的，可能会导致数据一致性的问题。
3. 网络延迟：由于Redis Cluster模式需要节点之间的通信和数据交互，如果网络延迟过高，可能会影响整个集群的性能。
4. 单点故障：虽然Redis Cluster模式可以处理节点的故障转移，但如果所有的节点都出现了故障，整个集群可能会受到影响。
5. 扩展实践：目前Redis
   Cluster的横向扩展能力不是很好，原生的slots搬移方案效率很低。新增节点后，有些客户端比如Lettuce，会因为安全机制无法识别新节点。另外迁移时间也完全无法预估，迁移过程中遇到问题也无法回退。

Proxy + 哨兵模式
是在哨兵模式上层增加一层代理层集群，来进行redis请求的反向代理。

优点：

1. 水平扩展：支持多分片模式，可横向扩展；
2. 性能开销：redis连接较高时，需要消耗大量的CPU资源处理；将连接保持在proxy上，proxy和redis实例之间只保持很少的链连接，降低redis负担，避免因连接增加导致redis的时延升高；
3. 扩缩容：proxy的扩缩容，保持proxy的稳定性；
4. 安全性：屏蔽redis的auth鉴权，只需要proxy的鉴权即可；限制危险操作等；
5. 监控：可以在proxy层进行更全面的监控；

不足：

1. 运维复杂：维护多个哨兵集群，配置比较复杂；
2. 动态扩缩容复杂：需要人工进行数据迁移，保证迁移的正确性和可用性；
3. 请求时延：多一跳带来的时延；

Proxy + cluster模式
是在cluster模式上层增加一层代理层集群，来进行redis请求的反向代理。

优点：

1. 降低使用门槛：客户端连接代理层即可，屏蔽连接redis集群细节；
2. 提高客户端性能：使用非智能客户端还可以降低客户端的负载，因为智能客户端需要在客户端对key进行hash以确定将请求发送到哪个Redis节点，在QPS比较高的情况下会消耗客户端机器的CPU资源。
3. 单据群扩展性：proxy和redis集群中间优化集群示例变化对proxy连接的影响；
4. 多句群扩展性：单个Redis Cluster由于gossip协议的限制，横向扩展能力有限，集群规模在300个节点时，节点选主这类拓扑变更的效率就明显降低。同时，由于单个Redis实例的容量不宜过高，单个Redis
   Cluster也很难支持TB以上的数据规模。通过Proxy，我们可以对key做逻辑分片，这样单个Proxy就可以接入多个Redis
   Cluster，从客户端的视角来看，就相当于接入了一个能够支持更大数据规模的Redis集群。

集群部署类型
物理机集群
优点：

1. 硬件资源充足：由于使用物理机作为节点，可以获得更多的硬件资源，如CPU、内存、存储等，从而提供更好的性能。
2. 稳定性高：物理机集群的稳定性相对较高，因为每个节点都是独立的物理服务器，不容易受到其他节点的干扰。
3. 扩展性良好：物理机集群可以通过增加节点数量来扩展集群的规模，以支持更高的并发量和更大的数据存储需求。
   缺点：
1. 部署和管理复杂：使用物理机作为节点需要手动部署和管理每个节点，包括安装、配置和监控等操作，比较繁琐。
2. 资源利用率低：由于每个节点都是独立的物理服务器，资源利用率可能较低，容易造成浪费。
3. 成本较高：使用物理机集群需要购买和维护更多的服务器，成本相对较高。

适用场景：
Redis物理机集群适用于需要高度稳定性和可靠性的场景；
容器化器群
优点：

1. 部署和管理简单：容器化集群可以使用容器编排工具来自动化部署和管理节点，减少人工干预和操作成本。
2. 资源利用率高：容器化技术可以使得多个容器共享同一台物理服务器，从而提高资源利用率。
3. 快速扩展：容器化技术可以快速创建和扩展容器节点，从而快速扩展集群的规模。
4. 动态调整：容器化集群可以通过容器编排工具实现动态调整节点数量和资源配置，以适应不同的业务需求。

缺点：

1. 性能可能受到影响：由于容器化技术自身的特点，节点之间的网络延迟和性能可能会受到一定的影响。
2. 稳定性需要评估：虽然容器化技术可以提高资源的利用率和快速扩展集群规模，但也需要评估其对整个集群稳定性的影响。

适用场景：
Redis容器化集群适用于需要快速扩展和动态调整的场景；

容灾策略
主从模式分机房部署从库

1. 实现跨机房的读流量闭环；
2. 机房故障可以通过切换保持可用性；

cluster模式跨机房冷备

1. 在异地机房部署一个镜像redisCluster，单向同步数据作为冷备或者查询流量；

跨机房双向数据同步

1. 异地机房部署集群镜像；
2. 写入流量切分至不同机房并进行单向的数据同步；